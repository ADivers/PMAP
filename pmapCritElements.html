<!DOCTYPE html>
<html>
<head>
	<title>Critical Elements</title>


  	<link rel="stylesheet" type="text/css" href="assets/css/style.css">
		<link type="text/css" href="./styles/main.css">


  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/css/materialize.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/js/materialize.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.SPServices/2014.02/jquery.SPServices-2014.02.js"></script>
	<script src="scripts/app.js"></script>
	<script src="scripts/DOM.js"></script>
	<script src="scripts/spsQuery.js"></script>
	<script src="scripts/Staff.js"></script>
	<script src="scripts/util.js"></script>
	<script src="scripts/CritElem.js"></script>
	<script src="scripts/domUI.js"></script>
      <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

	<style type="text/css">
		body {
    background-color: lightgrey;
		}
    .card {
      padding:20px;
    }
    .brand-logo {
      padding: 20px;
    }
    #ofba {
      padding-left: 20px;
    }
    label {
    cursor: default;
    color:black;
  }
    a {
      color:black;
    }
  #textarea {
    height: 150px;
  }
    #empNameNav {
      text-align: center;
      color: white;
      background-color: #002071 ;
    }

	</style>
</head>
<body>

 <nav>
    <div class="nav-wrapper  blue darken-4" >
      <a href="index.html" id="ofba" class="brand-logo">OFBA | Talent Portal</a>
      <!-- <img src="assets/images/ofba.png"> -->
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a href="sass.html">Staff List</a></li>
        <li><a href="index.html">Talent Portal</a></li>
        <li><a href="collapsible.html">Messages</a></li>
      </ul>
    </div>
  </nav>
   <br>

   <!-- ************************* Side Navigation ******************************* -->
 <div class="row">
        <div class="col s12 m3">
             <ul class="collapsible" data-collapsible="accordion">

              <li>
                <div class="collapsible-header" id="empNameNav">
                  <a href="pmapIntroduction.html" >
                    <div>
                      <font color="white"><strong id="reviewee-name"></strong></font>
                    </div>
                  </a>
                </div>
                </li>


              <li>
                <div class="collapsible-header">
                  <a href="pmapIntroduction.html" >
                    <div id="colap">
                      <i class="material-icons">subject</i>
                      Introduction
                    </div>
                  </a>
                </div>
                <!-- <div class="collapsible-body grey lighten-3">
                <span>A) Administrative</span><BR><span>B) Individual</span>
                </div> -->
              </li>

              <li>
                  <div class="collapsible-header" >
                    <a href="pmapEmployeeInfo.html">
                       <div id="colap">
                          <i  class="material-icons">account_circle</i>
                          Employee Information
                        </div>
                    </a>
                  </div>
                 <!--  <div class="collapsible-body grey lighten-3">
                    <span>A) Administrative</span><BR><span>B) Individual</span>
                  </div> -->
              </li>

              <li>
                  <div class="collapsible-header active">
                    <a href="pmapCritElements.html">
                       <div id="colap">
                        <i class="material-icons">add_box</i>
                        Set Critical Elements
                        </div>
                    </a>
                  </div>
                    <div class="collapsible-body grey lighten-3">
                    <span>A) Administrative</span>
                    <BR>
                    <span>B) Individual</span>
                  </div>
              </li>

              <li>
                  <div class="collapsible-header">
                    <a href="pmapMidYear.html">
                       <div id="colap">
                        <i class="material-icons">person</i>
                        Mid Year Review
                        </div>
                    </a>
                  </div>
              </li>


              <li>
                  <div class="collapsible-header">
                    <a href="pmapRating.html" >
                      <div id="colap">
                        <i class="material-icons">rate_review</i>
                        Rating
                      </div>
                    </a>
                  </div>
                  <!-- <div class="collapsible-body grey lighten-3">
                      <span>Lorem ipsum dolor sit amet.</span>
                      </div> -->
              </li>

              <li>
                  <div class="collapsible-header">
                    <a href="pmapConversion.html" >
                      <div id="colap">
                        <i class="material-icons">linear_scale</i>
                        Conversion
                      </div>
                    </a>
                  </div>
                  <!-- <div class="collapsible-body grey lighten-3">
                      <span>Lorem ipsum dolor sit amet.</span>
                      </div> -->
              </li>

              <li>
                <div class="collapsible-header">
                  <a href="pmapNarrative.html" >
                    <div id="colap">
                      <i class="material-icons">format_quote</i>
                      Written Narrative
                    </div>
                  </a>
                </div>
              <!-- <div class="collapsible-body grey lighten-3">
                  <span>Lorem ipsum dolor sit amet.</span>
                  </div> -->
              </li>

              <!-- <li>
                <div class="collapsible-header">
                  <a href="index.html" >
                    <div id="colap">
                      <i class="material-icons">question_answer</i>
                      Meeting in Review
                    </div>
                  </a>
                </div> -->
                  <!-- <div class="collapsible-body grey lighten-3">
                  <span>Lorem ipsum dolor sit amet.</span>
                  </div> -->
              <!-- </li> -->

              <li>
                <div class="collapsible-header">
                  <a href="pmapSign.html" >
                    <div id="colap">
                      <i class="material-icons">mode_edit</i>
                      Signature
                    </div>
                  </a>
                </div>
                  <!-- <div class="collapsible-body grey lighten-3">
                  <span>Lorem ipsum dolor sit amet.</span>
                  </div> -->
              </li>
            </ul>
        </div>
<!-- **********************************Side Nav END************************************** -->

	<div class="card col s12 m8">
		<h4>Critical Elements</h4>
		<p>Use this form to create/edit Critical Elements.</p>
	</div>
<!--******************************BEGIN CRIT ELEM EDIT FORM HERE************************* -->

	<div class="card col s12 m8">
			<div class="row">
				<form id="crit-elem-edit">
					<div id="job-details" class="row">
						<div class="col s4 input-field">
							<span>Position Description</span>
							<input type="text" name="pos-desc" id="pos-desc" disabled>
							<!-- <label for="pos-desc">Position Description</label> -->
						</div>
						<div class="col s4 input-field">
							<span>Occupation Series</span>
							<input type="text" name="occ-series" id="occ-series" disabled>
							<!-- <label for="occ-series">Occupation Series</label> -->
						</div>
						<div class="col s4 input-field">
							<span>GS Series</span>
							<input type="text" name="gs-series" id="gs-series" disabled>
							<!-- <label for="gs-series">GS Series</label> -->
						</div>
					</div>
					<div id="element-details" class="row">
						<!-- <div class="input-field col s4"> -->

							<!-- <select id="elem-title" name="elem-title">
								<option value="acct">Accounting</option>
								<option value="comms">Communications</option>
								<option value="analysis">Analysis</option>
								<option value="new">Create New</option>
							</select> -->
							<!-- <label>Critical Element Title</label> -->
							<!-- <textarea id="ele" name="elem-desc" class="materialize-textarea"></textarea>
							<label for="elem-desc">Element Description</label> -->
						<!-- </div> -->

						<div class="col s8">
							<label>Critical Element Title</label>
							<select id="elem-title" name="elem-title"></select>

							<div class="input-field">
								<label for="new-elem-title">New Element Title</label>
								<input type="text" id="new-elem-title" name="new-elem-title">
						 </div>
							<div class="input-field">
								<!-- <label for="elem-desc">Element Description</label> -->
								<span>Element Description</span>
								<textarea id="elem-desc" name="elem-desc" class="materialize-textarea"></textarea>
							</div>
							<div clas="input-field">
								<label for="elem-measure01">Measurements</label>
								<textarea id="elem-measure01" name="elem-measure01" class="materialize-textarea"></textarea>
						 </div>
						 <div class="left">
							 <button type="button" id="clear" class="waves-light waves-effect btn" value="Clear" visibility="hidden">Clear</button>
	 						 <button type="button" id="save" class="waves-light waves-effect btn" value="Save to PMAP">Save to PMAP</button>
						 </div>
						</div>
					</div>

				</form>
			</div>
			<div id="target" class="row"></div>
	</div>

<!--******************************END CRIT ELEM EDIT FORM HERE*************************-->

    <!-- <div class="col s12 m8">
     <div class="card white">
        <u><h5>Critical Element 1</h5></u>
        <div>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
        </div>
        <br>
        <a class="waves-effect waves-light btn blue darken-4 offset-s4" href="#critmodal1">Edit</a>
      </div> -->



<!-- ***************************************MODAL****************************************************************************
 -->
<!-- <div id="critmodal1" class="modal" style="z-index: 1003; display: none; opacity: 0; transform: scaleX(0.7); top: 4%;">
    <div class="modal-content">

      <div class="input-field col s12 m4">
			 <input type="text" id="pos-desc" name="pos-desc" disabled placeholder="Accountant">
       <label for="pos-desc">Position Description</label>
      </div>

		   <div class="input-field col s12 m4">
		    <input type="text" id="occ-series" name="occ-series" disabled placeholder="0510">
		    <label for="Occupation Series">Occupation Series</label>
		   </div>

			 <div class="input-field col s12 m4">
				<input type="text" id="gs-level" name="gs-level" disabled placeholder="14">
	      <label for="gs-level">GS Level</label>
	     </div>

			 <div class="input-field col s6">
				<select id="elem-title" name="elem-title">
					<option>Analysis</option>
				</select>
		    <label for="elem-title">Critical Element Title</label>
		   </div>

			 <div class="input-field col s6">
				<input type="text" id="elem-type" name="elem-type" disabled placeholder="Technical">
				<label for="elem-type">Element Type</label>
			</div> -->


      <!-- <label for="textarea">Critical Element Summary</label> -->
			<!-- <div class="input-field col s12">
				<textarea id="textarea1">
	        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
	      </textarea>
				<label for="textarea1">Element Description</label>
			</div>


    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close btn waves-effect waves-red blue darken-2">Cancel</a>
      <a href="#!" class="modal-action modal-close btn waves-effect waves-red blue darken-2">Save</a>
      <a href="#addCritModal" class="modal-action modal-close btn waves-effect waves-red blue darken-2">Create New Element</a>
      <a href="#" class="modal-action modal-close btn waves-effect waves-red blue darken-2">Delete Element</a>
    </div>
  </div>

<div id="addCritModal" class="modal" style="z-index: 1003; display: none; opacity: 0; transform: scaleX(0.7); top: 4%;">
    <div class="modal-content">

      <div class="input-field col s12 m6">
       <select>
            <option value="" disabled selected>Choose Occupation Series</option>
            <option value="1">Accountant</option>
            <option value="2">Budget Analyst</option>
            <option value="3">Acquisitions</option>
        </select>
          <label>Occupation Series</label>
      </div>

    <div class="input-field col s12 m6">
       <select>
          <option value="" disabled selected>Choose GS</option>
          <option value="1">GS-15</option>
          <option value="2">GS-14</option>
          <option value="3">GS-13</option>
        </select>
          <label>GS Level</label>
      </div>

      <div class="input-field col s6">
        <input  id="critElement1" type="text" >
        <label class="active" for="first_name2">Critical Element Title</label>
      </div> -->

      <!-- <label for="textarea">Add Critical Element</label> -->
      <!-- <textarea id="textarea1">
        </textarea>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close btn waves-effect waves-red blue darken-2">Cancel</a>
      <a href="#!" class="modal-action modal-close btn waves-effect waves-red blue darken-2">Save</a>
    </div>
  </div> -->
</div>
<!-- ***************************************MODAL 222 END******************************************************************************* -->
<div id="query-results"></div>

	<!-- <div id="query-results"></div> -->


  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/js/materialize.min.js"></script>

  <script type="text/javascript">

    $(document).ready(function(){
    $('.collapsible').collapsible();
    $('.modal').modal({
      dismissible: false, // Modal can NOT be dismissed by clicking outside of the modal
    });

    $('select').material_select();

		Materialize.updateTextFields();

		$(  '#job-details, #element-details'  ).css( {'margin-top' : '50px'}  );

		//Hide new Crit Elem form controls on load
		$(  '#clear, .input-field:has([id="new-elem-title"])'  ).hide();

		var currentReviewee = APP.spsQuery.parseCurrentReviewee(),

		//Build query object to return position ID of current reviewee
		//using `id` parameter from URL query string
		jobDetailsCAMLQuery = '<Query>\n' +
														'<Where>\n' +
															'<Eq>\n' +
																'<FieldRef Name="ID"/>\n' +
																'<Value Type="Text">' + currentReviewee.id + '</Value>\n' +
															'</Eq>\n' +
														'</Where>\n' +
													'</Query>',



		target = document.querySelector(  '#reviewee-name'  ),
	  qString = '&pmapDocID=' + currentReviewee.pmapDocID;

		target.innerText = 'Reviewee: ' + currentReviewee.firstName + ' ' + currentReviewee.lastName;

		/**Get reviewee positionID to begin querying critical element properties**/

			var positionQueryObj = APP.CritElem.getRevieweePositionQueryConfigObj();

			positionQueryObj.CAMLQuery = jobDetailsCAMLQuery;

			console.log(  'positionQueryObj: ');
			console.log(  positionQueryObj  );

			APP.CritElem.getRevieweePosition(  positionQueryObj  );



		/**---------------------------------------------------------------------**/
		/**
		*TODO: Consider deleting call to 'getCritElemsAdmin' if you're not
		*using them on this page
		*
		*/
		//APP.CritElem.getCritElemsAdmin(  currentReviewee  );

		//Populate element description and measurements on page load
		APP.dom.ui.showDeadlinesMeasurements();

		APP.util.attachNextURLs(  currentReviewee  );


		/**
		*TODO: 09/15/2017 09:37 EST
		*Update current PMAP record with new/edited Critical Elements
		*/
		$(  '#save'  ).on(  'click', function(  event  ){

			//RESET $vals IF EXISTS
			// var $vals = false;
			// var index = false;
			//end reset $vals


			$vals = $(  '#crit-elem-edit'  ).serializeArray();

			console.log(  '##############------>From pmapCritElems.html on CLICK: vals<-------##############'  );
			console.log(  $vals  );

			var newCritElem = {
													elemTitle				:			false,
													description 		: 		$vals[  2  ].value,
													measurements		:			$vals[  3  ].value,
													elemCreatorID		:			"MGR-12345"
												};
			if(  $vals[  0  ][  'value'  ] === 'Create New'  ){
				newCritElem.elemTitle = $vals[  1  ][  'value'  ];
			}
			else if(  $vals[  1  ][  'value'  ] === ''  ){
				newCritElem.elemTitle = $vals[  0  ][  'value'  ];
			}
			console.log(  '##############------>From pmapCritElems.html on CLICK: newCritElem<-------##############'  );
			console.log(  newCritElem  );
			APP.dom.ui.buildNewCritElemDiv(  newCritElem  );


			var queryConfigObj = APP.CritElem.getSaveCustomElemsQueryObj(),
					queryObjCopy = APP.util.extendDeep(  queryConfigObj  );

			//Attach form values to query config object for use in retrieval of new
			//critical element during save to PMAP doc
			//queryConfigObj.vals = $vals;
			queryObjCopy.vals = $vals;

			console.log(  queryObjCopy  );
			var string = '<Field Name="elemTitle">' + $vals[  1  ][  'value'  ] + '</Field>\n' +
			  					 '<Field Name="description">' + $vals[  2  ][  'value'  ] + '</Field>\n' +
									 '<Field Name="measurements">' + $vals[  3  ][  'value'  ] + '</Field>\n' +
									 '<Field Name="elemCreatorID">' + "MGR-12345" + '</Field>\n';
			//queryConfigObj.updates += string;
			queryObjCopy.updates += string;

			// for(  index in newCritElem  ){
			// 	var string = '<Field Name="' + index + '">' + newCritElem[  index  ] + '</Field>\n';
			// 	queryConfigObj.updates += string;
			// }

			// for(  var i = 0; i < queryConfigObj[  'vals'  ].length; i+= 1  ){
			// 	var string = '<Field Name="' +  index + '">' + queryConfigObj[  'vals'  ][  i  ][  ] + '</Field>\n';
			// }
			// for(  var index in queryConfigObj.vals  ){
			// 	var string = '<Field Name="' +  index + '">' + newCritElem[  index  ] + '</Field>\n';
			// 	queryConfigObj.updates += string;
			// }

			//queryConfigObj.updates += '<Field Name="ID">New</Field>';
			//queryConfigObj.updates += '</Method></Batch>';

			queryObjCopy.updates += '<Field Name="ID">New</Field>';
			queryObjCopy.updates += '</Method></Batch>';

			console.log(  '&&&&&&&&&&&&&&--->queryObjCopy:'  );
			//console.log(  queryConfigObj  );
			console.log(  queryObjCopy  );

			//APP.CritElem.saveNewCustomElem(  queryConfigObj  );
			//APP.spsQuery.updateSPSRecord(  queryConfigObj  );

			/**
			*NOTE: MUST MUST MUST MUST
			*--Use SINGLE QUOTES to surround string literals for "New" object 'updates' param
			*--Set the 'ID' field reference LAST
			*
			*/
			//APP.spsQuery.updateSPSRecord(  queryConfigObj  ); //-->Not allowing multiple saves;


			$().SPServices(  queryObjCopy  ); //-->OK; allowing multiple saves



			//Clear form values and $vals object
			//delete(  queryConfigObj.updates  );
			$(  '#crit-elem-edit input[name*="elem"], #crit-elem-edit textarea[name*="elem"]'  ).text( '' ).val(  ''  );
			//Redirect on save
			//APP.util.nextURL(  currentReviewee, './pmapMidYear.html'  );
		});

  });


// Select drop down controls
  $(document).ready(function() {
    $('select').material_select();
  });
  $('select').material_select('destroy');

  // Automatically fill text box in modal
   $(document).ready(function() {
    Materialize.updateTextFields();
  });

// Automatically resize modal text box based on text size
  $('#textarea1').val('New Text');
  $('#textarea1').trigger('autoresize');



  </script>


</body>
</html>
